<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- 메타데이터 및 라이브러리 로드 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Master: 다국어 어휘 도전 & 교재 학습</title>
    <!-- PDF.js 및 XLSX 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

    <!-- 스타일시트 -->
    <style>
        /* Reset 스타일 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 기본 바디 스타일 */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f7f9fc;
            color: #2c3e50;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 헤더 스타일 */
        h1 {
            font-size: 2.2rem;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 20px;
            text-align: center;
        }

        p {
            font-size: 1.1rem;
            margin-bottom: 15px;
            line-height: 1.4;
            text-align: center;
        }

        /* 컨테이너 스타일 */
        .container {
            max-width: 400px;
            width: 100%;
            margin: 20px auto;
            padding: 30px 20px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 입력 필드 스타일 */
        select, input {
            padding: 15px;
            font-size: 1rem;
            margin-bottom: 20px;
            border: 2px solid #3498db;
            border-radius: 8px;
            outline: none;
            width: 100%;
            transition: all 0.3s ease;
        }

        /* 버튼 스타일 */
        button {
            padding: 15px;
            font-size: 1.1rem;
            width: 100%;
            color: white;
            background-color: black;
            border: 3px solid black;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 15px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-weight: bold;
        }

        button:disabled {
            background-color: #e0e0e0;
            color: #bbb;
            cursor: not-allowed;
        }

        button:hover {
            transform: translateY(-2px);
        }

        /* 진행 바 스타일 */
        .progress-bar {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 25px;
            height: 25px;
            overflow: hidden;
            margin-top: 20px;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0;
            background-color: #3498db;
            border-radius: 25px;
            transition: width 0.5s ease;
        }

        /* 상태 바 스타일 */
        .status-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        /* 단어 컨테이너 스타일 */
        .word-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 선택지 스타일 */
        .option {
            margin-bottom: 10px;
            padding: 15px;
            background-color: #fff;
            border: 2px solid #3498db;
            border-radius: 8px;
            width: 100%;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        .option:hover {
            background-color: #ecf0f1;
        }

        /* 정답 및 오답 스타일 */
        .option.correct {
            background-color: #2ecc71;
            color: #fff;
            border-color: #27ae60;
        }

        .option.incorrect {
            background-color: #e74c3c;
            color: #fff;
            border-color: #c0392b;
        }

        /* PDF 컨테이너 스타일 */
        .pdf-container {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            text-align: center;
        }

        canvas {
            width: 80%;
            max-width: 500px;
            border: 1px solid black;
            margin-bottom: 10px;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin: 10px auto;
        }

        .nav-input {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 모바일 최적화 */
        @media (max-width: 600px) {
            canvas {
                width: 100%;
                max-width: none;
            }
            body {
                padding: 10px;
            }
            h1 {
                font-size: 1.8rem;
            }
            button {
                padding: 12px;
            }
        }

        /* Wordle 게임 스타일 */
        #wordleContainer {
            display: none;
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }

        .wordle-row {
            display: flex;
            justify-content: center;
            margin-bottom: 5px;
        }

        .wordle-tile {
            width: 50px;
            height: 50px;
            border: 2px solid #ccc;
            margin: 2px;
            font-size: 2rem;
            text-transform: uppercase;
            text-align: center;
            line-height: 50px;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .wordle-tile.correct {
            background-color: #2ecc71;
            border-color: #27ae60;
            color: #fff;
        }

        .wordle-tile.present {
            background-color: #f1c40f;
            border-color: #d4ac0d;
            color: #fff;
        }

        .wordle-tile.absent {
            background-color: #95a5a6;
            border-color: #7f8c8d;
            color: #fff;
        }

        .wordle-tile.flip {
            animation: flip 0.5s ease;
        }

        @keyframes flip {
            0% {
                transform: rotateX(0);
            }
            50% {
                transform: rotateX(90deg);
            }
            100% {
                transform: rotateX(0);
            }
        }

        /* Wordle 키보드 스타일 */
        .wordle-keyboard {
            margin-top: 20px;
        }

        .wordle-keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 5px;
        }

        .wordle-key {
            width: 40px;
            height: 50px;
            margin: 2px;
            background-color: #ccc;
            border: none;
            font-size: 1rem;
            text-transform: uppercase;
            cursor: pointer;
            font-weight: bold;
        }

        .wordle-key.correct {
            background-color: #2ecc71;
            color: #fff;
        }

        .wordle-key.present {
            background-color: #f1c40f;
            color: #fff;
        }

        .wordle-key.absent {
            background-color: #95a5a6;
            color: #fff;
        }

        .wordle-message {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* 모바일 화면에서의 Wordle 키보드 크기 조정 */
        @media (max-width: 600px) {
            .wordle-tile {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
                line-height: 40px;
            }

            .wordle-key {
                width: 30px;
                height: 40px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

    <!-- 메인 메뉴 -->
    <div class="container" id="mainMenu">
        <h1>Word Master: 다국어 어휘 도전</h1>
        <p>빠르고 재미있는 퀴즈로 어휘력을 키우세요.</p>
        <p>학습의 재미를 경험하세요!</p>

        <!-- 언어 선택 -->
        <select id="languageSelect">
            <option value="english">English</option>
            <!-- 다른 언어 추가 가능 -->
        </select>

        <!-- 레벨 선택 -->
        <select id="levelSelect">
            <option value="A1">A1 - 초급</option>
            <option value="A2">A2 - 초급</option>
            <option value="B1">B1 - 중급</option>
            <option value="B2">B2 - 중급</option>
            <option value="C1">C1 - 고급</option>
        </select>

        <!-- 시간 제한 입력 -->
        <label for="timeLimit">시간 제한 (초): </label>
        <input type="number" id="timeLimit" placeholder="30" min="10" max="60">

        <!-- 게임 시작 버튼 -->
        <button id="startButton">게임 시작(한글보고 영어입력)</button>
        <button id="startButton2">게임 시작(영어보고 뜻 선택)</button>

        <!-- 기타 기능 버튼 -->
        <button id="viewPdfButton">교재 보기</button>
        <button id="startCEFRTest">CEFR 레벨 테스트 시작</button>
        <button id="startWordleButton">Wordle 게임 시작</button>
    </div>

    <!-- 첫 번째 게임 모드 (한글보고 영어입력) -->
    <div class="container" id="gameContainer1" style="display:none;">
        <div class="status-bar">
            <div id="scoreDisplay">점수: 0</div>
            <div id="timerDisplay">남은 시간: 30초</div>
        </div>

        <div class="word-container">
            <div class="word-item" id="koreanWord" style="font-size: 1.5rem; margin-bottom: 20px;">여기에 한글 단어가 표시됩니다</div>
            <input type="text" id="englishInput" placeholder="영어 단어를 입력하세요" onkeypress="handleKeyPress(event)" autocomplete="off">
        </div>

        <p id="message"></p>

        <button id="submitButton" onclick="checkAnswer()">제출</button>
        <button id="skipButton" class="next-btn" onclick="skipWord()">다음으로 넘기기</button>
        <button id="listenButton" onclick="playWordAudio()">음성 듣기</button>

        <div class="progress-bar">
            <div class="progress-bar-fill" id="progressBar"></div>
        </div>

        <div id="questionCounter">0 / 0</div>

        <button class="home-btn" onclick="goHome()">홈으로 돌아가기</button>

        <!-- 정답 소리 추가 -->
        <audio id="correctSound">
            <source src="https://actions.google.com/sounds/v1/cartoon/ascending_boing.ogg" type="audio/ogg">
            Your browser does not support the audio element.
        </audio>
    </div>

    <!-- 두 번째 게임 모드 (영어보고 뜻 선택) -->
    <div class="container" id="gameContainer2" style="display:none;">
        <div class="status-bar">
            <div id="scoreDisplay2">점수: 0</div>
            <div id="timerDisplay2">남은 시간: 30초</div>
        </div>

        <div class="word-container">
            <div class="word-item" id="englishWord" style="font-size: 1.5rem; margin-bottom: 20px;">단어가 여기에 표시됩니다</div>
        </div>

        <div id="optionsContainer">
            <div class="option" id="option1" onclick="checkAnswer2('option1')"></div>
            <div class="option" id="option2" onclick="checkAnswer2('option2')"></div>
            <div class="option" id="option3" onclick="checkAnswer2('option3')"></div>
        </div>

        <div class="progress-bar">
            <div class="progress-bar-fill" id="progressBar2"></div>
        </div>

        <div id="questionCounter2">0 / 0</div>

        <button class="home-btn" onclick="goHome()">홈으로 돌아가기</button>

        <!-- 정답 소리 추가 -->
        <audio id="correctSound2">
            <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg">
            Your browser does not support the audio element.
        </audio>
    </div>

    <!-- 교재 보기 -->
    <div class="pdf-container" id="pdfContainer" style="display: none;">
        <h1>교재 보기</h1>
        <canvas id="pdfCanvas"></canvas>
        <div class="nav-buttons">
            <button id="prevButton" onclick="prevPage()">이전 페이지</button>
            <button id="nextButton" onclick="nextPage()">다음 페이지</button>
        </div>
        <div class="nav-input">
            <input type="number" id="pageNumberInput" placeholder="페이지" min="1">
            <button onclick="goToPage()">이동</button>
        </div>
        <button onclick="goHome()">홈으로 돌아가기</button>
    </div>

    <!-- CEFR 레벨 테스트 -->
    <div class="container" id="cefrTestContainer" style="display:none;">
        <div class="status-bar">
            <div id="cefrQuestionCounter">0 / 0</div>
        </div>

        <div class="word-container">
            <div class="word-item" id="cefrQuestion" style="font-size: 1.5rem; margin-bottom: 20px;">질문이 여기에 표시됩니다</div>
        </div>

        <div id="cefrOptionsContainer">
            <div class="option" id="cefrOption1" onclick="checkCEFRAnswer('cefrOption1')"></div>
            <div class="option" id="cefrOption2" onclick="checkCEFRAnswer('cefrOption2')"></div>
            <div class="option" id="cefrOption3" onclick="checkCEFRAnswer('cefrOption3')"></div>
            <div class="option" id="cefrOption4" onclick="checkCEFRAnswer('cefrOption4')"></div>
        </div>

        <button class="home-btn" onclick="goHome()">홈으로 돌아가기</button>
    </div>

    <!-- Wordle 게임 컨테이너 -->
    <div class="container" id="wordleContainer" style="display: none;">
        <h1>Wordle 게임</h1>
        <div id="wordleGrid">
            <!-- 단어 입력 칸이 JavaScript로 생성됩니다 -->
        </div>
        <div class="wordle-keyboard">
            <!-- 가상 키보드 -->
            <div class="wordle-keyboard-row">
                <button class="wordle-key">q</button>
                <button class="wordle-key">w</button>
                <button class="wordle-key">e</button>
                <button class="wordle-key">r</button>
                <button class="wordle-key">t</button>
                <button class="wordle-key">y</button>
                <button class="wordle-key">u</button>
                <button class="wordle-key">i</button>
                <button class="wordle-key">o</button>
                <button class="wordle-key">p</button>
            </div>
            <div class="wordle-keyboard-row">
                <button class="wordle-key">a</button>
                <button class="wordle-key">s</button>
                <button class="wordle-key">d</button>
                <button class="wordle-key">f</button>
                <button class="wordle-key">g</button>
                <button class="wordle-key">h</button>
                <button class="wordle-key">j</button>
                <button class="wordle-key">k</button>
                <button class="wordle-key">l</button>
            </div>
            <div class="wordle-keyboard-row">
                <button class="wordle-key" data-key="enter">Enter</button>
                <button class="wordle-key">z</button>
                <button class="wordle-key">x</button>
                <button class="wordle-key">c</button>
                <button class="wordle-key">v</button>
                <button class="wordle-key">b</button>
                <button class="wordle-key">n</button>
                <button class="wordle-key">m</button>
                <button class="wordle-key" data-key="backspace">←</button>
            </div>
        </div>
        <div class="wordle-message" id="wordleMessage"></div>
        <button class="home-btn" onclick="goHome()">홈으로 돌아가기</button>
    </div>

    <!-- 푸터 -->
    <footer>
        제작: 김성실 | 문의: <a href="mailto:sungsil.kim@lcnine.kr">sungsil.kim@lcnine.kr</a>
    </footer>

    <!-- 스크립트 -->
    <script>
        // 주요 변수 선언
        let correctWords = [];
        let currentWordIndex = 0;
        let score = 0;
        let correctAnswerGiven = false;
        let timeLeft = 30;
        let timer;
        let currentEnglishWord = "";
        let pdfDoc = null,
            pageNum = 1,
            pageRendering = false,
            pageNumPending = null;

        let gameMode = 1; // 1: 한글보고 영어입력, 2: 영어보고 뜻 선택

        let selectedLanguage = 'english'; // 선택된 언어

        // CEFR 테스트 관련 변수
        let cefrQuestions = [];
        let cefrCurrentIndex = 0;
        let cefrScore = 0;

        // Wordle 게임 관련 변수
        let wordleWords = [];
        let validWordleWords = [];
        let wordleAnswer = '';
        let wordleCurrentRow = 0;
        let wordleCurrentCol = 0;
        let wordleMaxRows = 6;
        let wordleMaxCols = 5;
        let wordleGrid = [];
        let wordleGameOver = false;

        // 언어 선택 이벤트 리스너
        document.getElementById('languageSelect').addEventListener('change', function() {
            selectedLanguage = this.value;

            // 언어 선택에 따라 버튼 표시/숨김
            if (selectedLanguage === 'english') {
                document.getElementById('levelSelect').style.display = 'block';
                document.getElementById('viewPdfButton').style.display = 'block';
                document.getElementById('startButton').style.display = 'block';
                document.getElementById('startButton2').style.display = 'block';
                document.getElementById('startCEFRTest').style.display = 'block';
                document.getElementById('startWordleButton').style.display = 'block';
            } else {
                document.getElementById('levelSelect').style.display = 'none';
                document.getElementById('viewPdfButton').style.display = 'none';
                document.getElementById('startButton').style.display = 'none';
                document.getElementById('startButton2').style.display = 'block';
                document.getElementById('startCEFRTest').style.display = 'none';
                document.getElementById('startWordleButton').style.display = 'none';
            }
        });

        // 게임 시작 버튼 이벤트 리스너
        document.getElementById('startButton').addEventListener('click', function() {
            gameMode = 1;
            startGame();
        });

        document.getElementById('startButton2').addEventListener('click', function() {
            gameMode = 2;
            startGame();
        });

        // 기타 버튼 이벤트 리스너
        document.getElementById('viewPdfButton').addEventListener('click', viewPdf);
        document.getElementById('startCEFRTest').addEventListener('click', startCEFRTest);
        document.getElementById('startWordleButton').addEventListener('click', startWordleGame);

        // 게임 시작 함수
        function startGame() {
            const level = document.getElementById('levelSelect').value;
            const timeLimitInput = document.getElementById('timeLimit').value;
            timeLeft = timeLimitInput ? parseInt(timeLimitInput) : 30;

            if (selectedLanguage) {
                document.getElementById('mainMenu').style.display = 'none';

                if (selectedLanguage === 'english') {
                    if (gameMode === 1) {
                        document.getElementById('gameContainer1').style.display = 'block';
                    } else {
                        document.getElementById('gameContainer2').style.display = 'block';
                    }
                } else {
                    gameMode = 2;
                    document.getElementById('gameContainer2').style.display = 'block';
                }

                loadWords(level);
            } else {
                alert("언어를 선택해주세요!");
            }
        }

        // 단어 로드 함수
        function loadWords(level) {
            if (selectedLanguage === 'english') {
                let fileName;

                if (level === 'A1') {
                    fileName = 'A1WORD.xlsx';
                } else if (level === 'A2') {
                    fileName = 'A2WORD.xlsx';
                } else if (level === 'B1') {
                    fileName = 'B1WORD.xlsx';
                } else if (level === 'B2') {
                    fileName = 'B2WORD.xlsx';
                } else if (level === 'C1') {
                    fileName = 'C1WORD.xlsx';
                }

                fetch(fileName)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('파일을 불러오지 못했습니다.');
                        }
                        return response.arrayBuffer();
                    })
                    .then(data => {
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheetName = workbook.SheetNames[0];
                        const sheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                        correctWords = shuffleArray(jsonData.slice(1));
                        currentWordIndex = 0;
                        score = 0;
                        correctAnswerGiven = false;

                        if (gameMode === 1) {
                            document.getElementById('scoreDisplay').textContent = `점수: ${score}`;
                            document.getElementById('questionCounter').textContent = `0 / ${correctWords.length}`;
                            updateProgressBar();
                            displayNextWord();
                        } else {
                            document.getElementById('scoreDisplay2').textContent = `점수: ${score}`;
                            document.getElementById('questionCounter2').textContent = `0 / ${correctWords.length}`;
                            updateProgressBar2();
                            displayNextWord2();
                        }
                    })
                    .catch(error => {
                        alert('단어 파일을 불러오는 중 오류가 발생했습니다: ' + error.message);
                        document.getElementById('mainMenu').style.display = 'block';
                        document.getElementById('gameContainer1').style.display = 'none';
                        document.getElementById('gameContainer2').style.display = 'none';
                    });
            } else {
                // 다른 언어의 경우 샘플 단어 사용 또는 추가 가능
            }
        }

        // 단어 섞기 함수
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // 게임 모드별 함수들
        // ... (displayNextWord, checkAnswer 등 기존 함수 유지)

        // Wordle 게임 시작 함수
        function startWordleGame() {
            let wordleWordsFile;
            let validWordsFile;

            if (selectedLanguage === 'english') {
                wordleWordsFile = 'wordle_words.json';
                validWordsFile = 'valid_words.json';
            } else {
                alert('Wordle 게임은 현재 선택한 언어를 지원하지 않습니다.');
                return;
            }

            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('wordleContainer').style.display = 'block';

            Promise.all([
                fetch(wordleWordsFile).then(response => response.json()),
                fetch(validWordsFile).then(response => response.json())
            ])
            .then(([wordleData, validData]) => {
                wordleWords = wordleData.words;
                validWordleWords = validData.validWords;
                wordleAnswer = wordleWords[Math.floor(Math.random() * wordleWords.length)];
                console.log('정답:', wordleAnswer);
                initializeWordleGame();
            })
            .catch(error => {
                alert('단어 목록을 불러오는 중 오류가 발생했습니다: ' + error.message);
                goHome();
            });
        }

        // Wordle 게임 초기화 함수
        function initializeWordleGame() {
            wordleGrid = [];
            wordleCurrentRow = 0;
            wordleCurrentCol = 0;
            wordleGameOver = false;

            createWordleGrid();

            document.addEventListener('keydown', handleWordleKeydown);
            const keys = document.querySelectorAll('.wordle-key');
            keys.forEach(key => key.addEventListener('click', handleWordleClick));
        }

        // Wordle 그리드 생성 함수
        function createWordleGrid() {
            const gridElement = document.getElementById('wordleGrid');
            gridElement.innerHTML = '';
            for (let i = 0; i < wordleMaxRows; i++) {
                const row = [];
                const rowElement = document.createElement('div');
                rowElement.classList.add('wordle-row');
                for (let j = 0; j < wordleMaxCols; j++) {
                    const tileElement = document.createElement('div');
                    tileElement.classList.add('wordle-tile');
                    rowElement.appendChild(tileElement);
                    row.push('');
                }
                gridElement.appendChild(rowElement);
                wordleGrid.push(row);
            }
        }

        // Wordle 키 입력 처리 함수
        function handleWordleKeydown(event) {
            if (wordleGameOver) return;
            const key = event.key.toLowerCase();
            if (key === 'enter') {
                submitWordleGuess();
            } else if (key === 'backspace') {
                deleteWordleLetter();
            } else if (/^[a-z]$/.test(key)) {
                addWordleLetter(key);
            }
        }

        function handleWordleClick(event) {
            if (wordleGameOver) return;
            const key = event.target.getAttribute('data-key') || event.target.textContent.toLowerCase();
            if (key === 'enter') {
                submitWordleGuess();
            } else if (key === 'backspace' || key === '←') {
                deleteWordleLetter();
            } else if (/^[a-z]$/.test(key)) {
                addWordleLetter(key);
            }
        }

        // Wordle 글자 추가/삭제 함수
        function addWordleLetter(letter) {
            if (wordleCurrentCol < wordleMaxCols) {
                const rowElement = document.getElementsByClassName('wordle-row')[wordleCurrentRow];
                const tileElement = rowElement.children[wordleCurrentCol];
                tileElement.textContent = letter.toUpperCase();
                wordleGrid[wordleCurrentRow][wordleCurrentCol] = letter;
                wordleCurrentCol++;
            }
        }

        function deleteWordleLetter() {
            if (wordleCurrentCol > 0) {
                wordleCurrentCol--;
                const rowElement = document.getElementsByClassName('wordle-row')[wordleCurrentRow];
                const tileElement = rowElement.children[wordleCurrentCol];
                tileElement.textContent = '';
                wordleGrid[wordleCurrentRow][wordleCurrentCol] = '';
            }
        }

        // Wordle 단어 제출 함수
        function submitWordleGuess() {
            if (wordleCurrentCol < wordleMaxCols) {
                showWordleMessage('글자를 모두 입력하세요.');
                return;
            }

            const guess = wordleGrid[wordleCurrentRow].join('');
            if (!validWordleWords.includes(guess)) {
                showWordleMessage('유효한 단어가 아닙니다.');
                return;
            }

            const rowElement = document.getElementsByClassName('wordle-row')[wordleCurrentRow];
            const keyButtons = document.querySelectorAll('.wordle-key');

            for (let i = 0; i < wordleMaxCols; i++) {
                const tileElement = rowElement.children[i];
                const letter = wordleGrid[wordleCurrentRow][i];

                // 애니메이션 적용
                setTimeout(() => {
                    tileElement.classList.add('flip');

                    if (wordleAnswer[i] === letter) {
                        tileElement.classList.add('correct');
                        keyButtons.forEach(key => {
                            if (key.textContent.toLowerCase() === letter) {
                                key.classList.remove('present');
                                key.classList.add('correct');
                            }
                        });
                    } else if (wordleAnswer.includes(letter)) {
                        tileElement.classList.add('present');
                        keyButtons.forEach(key => {
                            if (key.textContent.toLowerCase() === letter && !key.classList.contains('correct')) {
                                key.classList.add('present');
                            }
                        });
                    } else {
                        tileElement.classList.add('absent');
                        keyButtons.forEach(key => {
                            if (key.textContent.toLowerCase() === letter) {
                                key.classList.add('absent');
                            }
                        });
                    }
                }, i * 300); // 각 타일마다 지연 시간 적용
            }

            setTimeout(() => {
                if (guess === wordleAnswer) {
                    showWordleMessage('축하합니다! 정답을 맞추셨습니다!');
                    wordleGameOver = true;
                    document.removeEventListener('keydown', handleWordleKeydown);
                } else {
                    wordleCurrentRow++;
                    wordleCurrentCol = 0;
                    if (wordleCurrentRow >= wordleMaxRows) {
                        showWordleMessage(`실패했습니다. 정답은 '${wordleAnswer.toUpperCase()}' 입니다.`);
                        wordleGameOver = true;
                        document.removeEventListener('keydown', handleWordleKeydown);
                    }
                }
            }, wordleMaxCols * 300);
        }

        // Wordle 메시지 표시 함수
        function showWordleMessage(message) {
            const messageElement = document.getElementById('wordleMessage');
            messageElement.textContent = message;
            setTimeout(() => {
                messageElement.textContent = '';
            }, 3000);
        }

        // 홈으로 돌아가기 함수
        function goHome() {
            // 모든 컨테이너 숨기기
            document.getElementById('gameContainer1').style.display = 'none';
            document.getElementById('gameContainer2').style.display = 'none';
            document.getElementById('pdfContainer').style.display = 'none';
            document.getElementById('cefrTestContainer').style.display = 'none';
            document.getElementById('wordleContainer').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';

            // 타이머 중지
            clearInterval(timer);

            // Wordle 게임 초기화
            document.removeEventListener('keydown', handleWordleKeydown);
            const keys = document.querySelectorAll('.wordle-key');
            keys.forEach(key => key.removeEventListener('click', handleWordleClick));
        }

        // 페이지 로드 시 초기 설정
        window.onload = () => {
            document.getElementById('mainMenu').style.display = 'block';
            document.getElementById('gameContainer1').style.display = 'none';
            document.getElementById('gameContainer2').style.display = 'none';
            document.getElementById('pdfContainer').style.display = 'none';
            document.getElementById('cefrTestContainer').style.display = 'none';
            document.getElementById('wordleContainer').style.display = 'none';

            if (selectedLanguage === 'english') {
                document.getElementById('startCEFRTest').style.display = 'block';
                document.getElementById('startWordleButton').style.display = 'block';
            } else {
                document.getElementById('startCEFRTest').style.display = 'none';
                document.getElementById('startWordleButton').style.display = 'none';
            }
        };

        // 기타 필요한 함수들 (예: viewPdf, startCEFRTest 등)은 기존 코드를 그대로 사용합니다.
        // 전체 코드 길이로 인해 모든 함수를 여기 포함하지는 않았지만, 기존 코드에서 필요한 함수들을 추가하시면 됩니다.
    </script>
</body>
</html>
